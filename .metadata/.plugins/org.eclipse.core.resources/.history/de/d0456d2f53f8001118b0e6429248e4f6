package edu.uw.cs.cse461.OSConsoleApps;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.util.Set;

import edu.uw.cs.cse461.OS.OS;
import edu.uw.cs.cse461.OS.OSLoadableInterface.OSLoadableApp;

/**
 * An AppManager acts someting like a shell on a traditional system - it lets
 * you run apps (OSConsoleApps).  Unlike traditional systems, but something
 * like Android, there is only one instance of an app created, no matter how
 * many times it's invoked.  In this system, all apps are loaded when the 
 * OS boots.  An app invocation is merely a call to its run() method.
 * The AppManager   
 * @author zahorjan
 *
 */
public class AppManager implements OSLoadableApp {
	private static final String TAG="AppManager";
	
	public String loadablename() { return "appmanager"; }

	public void shutdown() {}
	
	/**
	 * Constructor required by OSConsoleApp.
	 * 
	 * @param args String[] argument passed to main().
	 * @throws Exception
	 */
	public AppManager() {
	}

	/**
	 * This method implements a very primitive shell.  Apps are "run in the foreground."
	 * @throws Exception
	 */
	public void run() throws Exception {
		// Eclipse doesn't support System.console()
		BufferedReader console = new BufferedReader(new InputStreamReader(System.in));
		
		Set<String> apps = OS.theOS().loadedAppNames();
		String prompt = new String("Enter app name (");
		for ( String name : apps ) {
			if ( name.equals(loadablename()) ) continue;
			prompt += name + ", ";
		}
		prompt = prompt.substring(0, prompt.length()-2) + "), or exit: "; 

		while (true) {
			System.out.print(prompt);
			String appName = console.readLine();

			if ( appName == null ) continue;
			if ( appName.equals("exit") ) break;

			try {
				OS.theOS().startApp(appName);
			} catch (Exception e) {
				System.out.println("Exception: " + e.getMessage());
			}
		}
	}
}
