package edu.uw.cs.cse461.sp12.OS;

import java.lang.reflect.Method;

import org.json.JSONObject;

public abstract class RPCCallable {

	/**
	 * An object of this type represents an RPC callable method.  You'll have one
         * object of this type for each method exposed by RPC.
	 * <p>
	 * The parameterized type, T, is the class exposing the method.
	 * <p>
	 * See the source in EchoService.java for an example of its use.
	 * @author zahorjan
	 *
	 * @param <T>
	 */
	protected static class RPCCallableMethod<T> {
		T service;
		Method method;
		/**
		 * Constructor.
		 * @param serviceObject The Java instance of the object that will field the RPC
		 * @param methodName The name of the Java method to invoke on that object, as a String
		 * @throws NoSuchMethodException
		 */
		RPCCallableMethod(T serviceObject, String methodName) throws NoSuchMethodException { 
			service = serviceObject; 
			Class<T> serviceClass = (Class<T>)service.getClass();
			method = serviceClass.getMethod(methodName, JSONObject.class);
		}
		/**
		 * This method is called to actually invoke the method that handles the RPC.
		 * @param args  The arguments to pass on this call
		 * @return The JSONObject returned by the RPC handling method of the service
		 * @throws Exception
		 */
		public JSONObject handleCall(JSONObject args) throws Exception {
			return (JSONObject)method.invoke(service, args);
		}
	}
	
}
