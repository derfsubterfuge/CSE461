package edu.uw.cs.cse461.OSConsoleApps;

import edu.uw.cs.cse461.OS.OS;
import edu.uw.cs.cse461.OS.OSLoadable.OSLoadableApp;
import edu.uw.cs.cse461.OS.RPCService;

/**
 * A ConsoleApp that prints the IP/port of the RPC service on the local machine.
 * 
 * @author zahorjan
 *
 */
public class WhoAmI implements OSLoadableApp {
	
	/**
	 * OSConsoleApp's must have a constructor taking no arguments.  The constructor can initialize,
	 * but shouldn't perform any of the function of the app.  That's done in the run() method.
	 */
	public WhoAmI() {
	}

	/**
	 * A OSConsoleApp must have an appname() method.  (The name doesn't have to match the class name,
	 * but does have to be unique among all apps.)
	 */
	public String loadablename() {
		return "whoami";
	}

	/**
	 * This method will be called each time the app is invoked (by the AppManager).
	 */
	public void run() {
		try {
			
			String hostname = OS.theOS().hostname();
			if ( hostname != null ) {
				if ( hostname.isEmpty()) System.out.println("Host: root");
				else System.out.println("Host: '" + hostname + "'");
			}
			else System.out.println("Host: none");
			RPCService rpcService = (RPCService)OS.theOS().getService("rpc");
			System.out.println("IP: " + rpcService.localIP() + "  Port: " + rpcService.localPort());
		} catch (Exception e) {
			System.out.println("Caught exception: " + e.getMessage());
		}
	}

	/**
	 * Required to be an OSConsoleApp.  This is called when the entire system is going down (i.e., not
	 * at the end of each execution).  In the case of WhoAmI, there's nothing that needs doing.
	 */
	public void shutdown() {
	}
}
