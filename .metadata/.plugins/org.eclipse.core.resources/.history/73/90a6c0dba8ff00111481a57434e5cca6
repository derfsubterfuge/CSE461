package edu.uw.cs.cse461.ConsoleApps;

import java.io.BufferedReader;
import java.io.InputStreamReader;

import org.json.JSONObject;

import edu.uw.cs.cse461.Net.Base.NetLoadable.NetLoadableConsoleApp;
import edu.uw.cs.cse461.Net.RPC.RPC;

public class EchoDDNS extends NetLoadableConsoleApp {

	/**
	 * A public constructor taking no arguments is required for loadable apps.
	 */
	public EchoDDNS() {
		super("echoddns", true);
	}
	
	@Override
	public void run() {
		try {
			// Eclipse doesn't support System.console()
			BufferedReader console = new BufferedReader(new InputStreamReader(System.in));
//			RPCCallerSocket socket = null;
			while ( true ) {
				try {
					System.out.print("Enter a host name, or exit to exit: ");
					String targetStr = console.readLine();
					if ( targetStr == null ) targetStr = "";
					else if ( targetStr.equals("exit")) break;
//					ARecord targetAddr = ((DDNSResolverService)NetBase.theNetBase().getService("ddnsresolver")).resolve(targetStr);

					System.out.print("Enter message to echoed: ");
					String msg = console.readLine();
					
//					socket = new RPCCallerSocket(targetStr, targetAddr.ip(), targetAddr.port());
//					JSONObject response = socket.invoke("echo", "echo", new JSONObject().put("msg", msg) );
					JSONObject response = RPC.invoke(targetStr, "echo", "echo", new JSONObject().put("msg", msg) );
					
					System.out.println(response.getString("msg"));
				} catch (Exception e) {
					System.out.println("Exception: " + e.getMessage());
				}
			}
		} catch (Exception e) {
			System.out.println("EchoDDNS.run() caught exception: " +e.getMessage());
		}
	}
	
	@Override
	public void shutdown() {
	}
	
}
